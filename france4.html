<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>France</title>    
	<style>		
	</style>
</head>

<body>
    <p>Créer un input type text</p>
	<p>L'utilisateur saisit les premiers caractéres de la ville qu'il recherchek</p>
	<p>Un appel Ajax affiche en dessous la liste des villes qui commencent par les caractères tapés.</p>
	<div>
		<label for="ville">Recherher une ville sur toute la france</label>
		<input type="text" id="ville"/>
	</div>
	<div>
		<label>Latitude</label><input type="text" id="lat">
		<label>longitude</label><input type="text" id="lng">
		<label>zoom</label><input type="text" id="zoom">
		<button onclick="btOk()">ok</button>
	</div>
	<div id="resultat"></div>
	<div id="map" style="height:400px"></div>	
</body>
<script>
let resultat=document.getElementById("resultat");
let ville= document.getElementById("ville");
ville.addEventListener("input",inputVille);
let newCenter={lat: 45, lng: 5};
let newZoom=2;
let newMap; 

function inputVille() {
	let saisie=ville.value;
	let xmlhttp = new XMLHttpRequest();
	let url = "http://localhost/tuto/JS/france/ajax_listevilles.php?saisie=" + saisie;
	xmlhttp.open("GET",url,true);
	xmlhttp.onreadystatechange=mafonction;
	xmlhttp.send();

	function mafonction() {
		if (xmlhttp.readyState==4 && xmlhttp.status==200)
		{			
			resultat.innerHTML=xmlhttp.responseText;
		}
	}
}

function btOk() {
	let latitude=parseFloat(document.getElementById("lat").value);
	let longitude=parseFloat(document.getElementById("lng").value);
	let zoom=parseFloat(document.getElementById("zoom").value);
	afficheVille(latitude,longitude,zoom);
}

//init google map
function initMap() {
	newMap = new google.maps.Map(document.getElementById('map'), {
		center: newCenter,
		zoom: newZoom
	});
}

//zoom sur une ville 		  
function afficheVille(latitude,longitude,zoom) {
	newCenter={lat:latitude,lng:longitude};
	newZoom=zoom;
	initMap();		 
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC575In87Ezt0AI_ePANmEMjoWKu6Gw-Ng&callback=initMap" 
async defer></script>

</html>